{
  "builders": [
    {
      "type": "qemu",
      "name": "windows2022-proxmox",
      "memory": "4096",
      "cpus": "4",
      "iso_url": "http://localhost:8080/Windows2022.iso",
      "iso_checksum": "sha256:3e4fa6d8507b554856fc9ca6079cc402df11a8b79344871669f0251535255325",
      "output_directory": "output-windows2022-proxmox",
      "vm_name": "win2022-template",
      "disk_size": "61440",
      "format": "qcow2",
      "disk_interface": "virtio",
      "net_device": "virtio-net",
      "headless": true,
      "accelerator": "kvm",
      "communicator": "winrm",
      "winrm_username": "Administrator",
      "winrm_password": "p@ssw0rd",
      "winrm_timeout": "6h",
      "winrm_port": 5985,
      "vnc_port_min": 5901,
      "vnc_port_max": 5901,
      "qemuargs" : [
        ["-vnc", ":1"]
      ],
      "winrm_insecure": true,
      "winrm_use_ssl": false,
      "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
      "http_directory": "http",
      "floppy_files": [
        "floppy/autounattend.xml",
        "scripts/install-guest-additions.ps1",
        "scripts/enable-winrm.ps1"
      ],
      "cd_files": [
        "http/virt"
      ],
      "boot_wait": "1s"
    }
  ],
  "provisioners": [
    {
      "type": "powershell",
      "inline": [
        "Write-Host 'WinRM is working!'"
      ]
    },
    {
      "type": "powershell",
      "scripts": [
        "scripts/install-chocolatey.ps1"
      ]
    },
    {
      "type": "powershell",
      "inline": [
        "Write-Host 'Installing software...'",
        "choco install -y git",
        "choco install -y googlechrome",
        "choco install -y notepadplusplus",
        "choco install -y 7zip",
        "choco install -y sysinternals",
        "choco install -y wireshark",
        "choco install -y vlc",
        "choco install -y python",
        "choco install -y vscode",
        "Write-Host 'Software installation complete.'"
      ]
    },
    {
      "type": "powershell",
      "scripts": [
        "scripts/sysprep.ps1"
      ]
    }
  ]

}